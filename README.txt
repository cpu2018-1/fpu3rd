各演算は200MHz1clk実装

・fdivは使用しない可能性がでてきたかつ、使用するとしても新しくコードを書き直す必要があるので一旦レポジトリから削除した。
・A/B　を fmul(A,finv(B))とみなした場合でもfdivの要件を満たせるように小数の解釈を変更した。

●全体的な仕様
基本的にはIEEE754と似たような数字の扱いをする。
32bit数{s,e,m}(s:1bit e:8bit m:23bit)　を
(-1) ^ s * 1.m * 2 ^ (e-127)
として解釈。
IEEE754ではeが0のときに非正規化数,255のときに非数やinfを表すことになっているが、
それらを表現できる必要はないことになってるので、
e = 0　のとき m = 0 のとき 0
            m!= 0 のとき (-1) ^ s * 1.m * 2 ^ (e-127)
e = 255 のとき 例外(このような数をモジュールの引数として渡すことも出力として吐き出すことも想定しない実装になっている)
としている。

とみなすことにした。(e = 0のときの扱いを少し変更。2^126 <= B < 2^127 のときfinv(B) == 0 となるのを防ぐためである)


●比較的重い処理(あまり時間的な余裕がない)
以下の4演算は時間的にかつかつなので演算の直前直後にレジスタを(32bit×4個)はさむ必要があると思う。

・fadd
subとモジュールを共有する。
fadd instance (ds_val,{dt_val[31] ^ ctrl[1],dt_val[30:0]},fadd_y)
とすることでfaddとfsubを適宜使用してくれるはず。

・finv
A / B を fmul(A,finv(B))
e = 0のときの解釈を変更することで、コーナーケースでも求められている精度は出すことができるようになりました。
お騒がせしました。

・fmul
・fsqrt
特記事項なし


●軽い処理
下記の演算は比較的時間に余裕があるはずなので
ctrlを見てレジスタ(32bit×1個)にまとめるぐらいはできるんじゃないかと思う。
正直配線遅延による部分も大きいので何とも言えないとこもあるが…。

・ftoi
レイトレで使われるfloat,int間の型変換が0丸め(絶対値切り捨て)だと聞いたのでそれで実装。
そういう仕様にすることに関してTAに許可をもらっている。

・feq,flt,fle
最初は各々モジュールとして用意することを想定していたが、ほぼ同じ考え方でできて3つのモジュールで変数を共有できるし
コードが短いのでわざわざモジュール化しない方がいい気がしてきた。
e = 0のときは全て0とみなしてるのでそれを考慮する必要がある。
レポジトリに一応残してあるflt.vは浮動小数を符号反転を駆使していい感じにソートする実装になっている。
3つの演算をまとめて

    wire s1,s2;
    wire [7:0] e1,e2;
    wire [22:0] m1,m2;
    assign s1 = x1[31:31];
    assign e1 = x1[30:23];
    assign m1 = x1[22:0];
    assign s2 = x2[31:31];
    assign e2 = x2[30:23];
    assign m2 = x2[22:0];

    wire s1a,s2a;
    wire [7:0] e1a,e2a;
    wire [22:0] m1a,m2a,m1b,m2b;
    assign s1a = (e1 == 8'b0) ? 1'b1: ~s1;
    assign e1a = (s1a) ? e1: ~e1;
    assign m1a = (e1 == 8'b0) ? 1'b0: m1;
    assign m1b = (s1a) ? m1a: ~m1a;
    assign s2a = (e2 == 8'b0) ? 1'b1: ~s2;
    assign e2a = (s2a) ? e2: ~e2;
    assign m2a = (e2 == 8'b0) ? 1'b0: m2;
    assign m2b = (s2a) ? m2a: ~m2a;

    wire [31:0] feq_y,flt_y,fle_y;
    assign feq_y = ({s1a,e1a,m1b} = {s2a,e2a,m2b});
    assign flt_y = ({s1a,e1a,m1b} < {s2a,e2a,m2b});
    assign fle_y = ({s1a,e1a,m1b} <= {s2a,e2a,m2b});

こんな感じで記述できると思う

・fneg
これもわざわざモジュールとして提供する意味は薄い。
    {~ds_val[31],ds_val[30:0]}

・itof
特記事項なし


